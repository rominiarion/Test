<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Tetris</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #00ff9d;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            min-width: 100px;
            text-align: center;
            border: 2px solid #00ff9d;
        }

        .score-label {
            display: block;
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .game-area {
                flex-direction: row;
            }
        }

        .side-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-board-container {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #game-board {
            background: #111;
            border-radius: 10px;
            border: 3px solid #00ff9d;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.3);
            width: 100%;
            max-width: 300px;
            height: 600px;
            display: block;
        }

        #next-piece {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 2px solid #00ff9d;
            margin-top: 10px;
            width: 150px;
            height: 150px;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ff9d, #00b8ff);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 255, 157, 0.4);
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .control-btn:active {
            transform: scale(0.9);
            box-shadow: 0 2px 8px rgba(0, 255, 157, 0.2);
        }

        .vertical-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drop-btn {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
        }

        .game-controls-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .start-btn {
            background: linear-gradient(135deg, #00b09b, #96c93d);
        }

        .pause-btn {
            background: linear-gradient(135deg, #ff9a00, #ff5e00);
        }

        .restart-btn {
            background: linear-gradient(135deg, #8a2387, #f27121);
        }

        .sound-controls, .controls-info, .high-scores, .next-piece-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h3 {
            color: #00ff9d;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sound-item, .control-item, .volume-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sound-item:last-child, .control-item:last-child {
            border-bottom: none;
        }

        .key-icon {
            background: rgba(0, 255, 157, 0.2);
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            border: 1px solid #00ff9d;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        input[type="range"] {
            width: 100px;
            height: 5px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ff9d;
            cursor: pointer;
        }

        .high-score-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        .mobile-message {
            text-align: center;
            padding: 10px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            border: 1px solid #ffc107;
            margin-top: 20px;
            display: none;
        }

        @media (max-width: 767px) {
            .mobile-message {
                display: block;
            }
            
            .side-panel {
                order: 2;
            }
            
            .game-board-container {
                order: 1;
            }
            
            #game-board {
                max-width: 100%;
                height: 400px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
            }
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .game-over-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 3px solid #00ff9d;
        }

        .pause-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .grid-square {
            position: absolute;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-gamepad"></i> TETRIS MOBILE</h1>
            <div class="score-board">
                <div class="score-item">
                    <span class="score-label">SKOR</span>
                    <span id="score" class="score-value">0</span>
                </div>
                <div class="score-item">
                    <span class="score-label">SEVƒ∞YE</span>
                    <span id="level" class="score-value">1</span>
                </div>
                <div class="score-item">
                    <span class="score-label">SATIR</span>
                    <span id="lines" class="score-value">0</span>
                </div>
            </div>
        </header>

        <div class="game-area">
            <div class="side-panel left-panel">
                <div class="next-piece-container">
                    <h3><i class="fas fa-arrow-right"></i> SONRAKƒ∞</h3>
                    <canvas id="next-piece" width="150" height="150"></canvas>
                </div>
                
                <div class="controls-info">
                    <h3><i class="fas fa-info-circle"></i> KONTROLLER</h3>
                    <div class="control-item">
                        <span class="key-icon">‚Üê ‚Üí</span>
                        <span>Hareket</span>
                    </div>
                    <div class="control-item">
                        <span class="key-icon">‚Üë</span>
                        <span>D√∂nd√ºr</span>
                    </div>
                    <div class="control-item">
                        <span class="key-icon">‚Üì</span>
                        <span>Hƒ±zlandƒ±r</span>
                    </div>
                    <div class="control-item">
                        <span class="key-icon">Space</span>
                        <span>Anƒ±nda Bƒ±rak</span>
                    </div>
                    <div class="control-item">
                        <span class="key-icon">P</span>
                        <span>Duraklat</span>
                    </div>
                </div>
            </div>

            <div class="game-board-container">
                <canvas id="game-board"></canvas>
                <div class="game-controls">
                    <button id="left-btn" class="control-btn"><i class="fas fa-arrow-left"></i></button>
                    <div class="vertical-controls">
                        <button id="rotate-btn" class="control-btn"><i class="fas fa-redo"></i></button>
                        <button id="down-btn" class="control-btn"><i class="fas fa-arrow-down"></i></button>
                    </div>
                    <button id="right-btn" class="control-btn"><i class="fas fa-arrow-right"></i></button>
                    <button id="drop-btn" class="control-btn drop-btn"><i class="fas fa-angle-double-down"></i></button>
                </div>
            </div>

            <div class="side-panel right-panel">
                <div class="game-controls-buttons">
                    <button id="start-btn" class="action-btn start-btn">
                        <i class="fas fa-play"></i> BA≈ûLAT
                    </button>
                    <button id="pause-btn" class="action-btn pause-btn">
                        <i class="fas fa-pause"></i> DURAKLAT
                    </button>
                    <button id="restart-btn" class="action-btn restart-btn">
                        <i class="fas fa-redo"></i> YENƒ∞DEN
                    </button>
                </div>

                <div class="sound-controls">
                    <h3><i class="fas fa-volume-up"></i> SESLER</h3>
                    <div class="sound-item">
                        <span>Oyun Sesleri</span>
                        <input type="checkbox" id="game-sound" checked>
                    </div>
                    <div class="sound-item">
                        <span>M√ºzik</span>
                        <input type="checkbox" id="music" checked>
                    </div>
                    <div class="volume-control">
                        <span>Ses Seviyesi</span>
                        <input type="range" id="volume" min="0" max="100" value="70">
                    </div>
                </div>

                <div class="high-scores">
                    <h3><i class="fas fa-trophy"></i> EN Y√úKSEK SKOR</h3>
                    <div id="high-scores-list"></div>
                </div>
            </div>
        </div>

        <div class="mobile-message">
            <p>Oyunu yatay modda oynamak daha iyi bir deneyim saƒülar!</p>
        </div>
    </div>

    <div id="game-over" class="game-over">
        <div class="game-over-content">
            <h2>OYUN Bƒ∞TTƒ∞!</h2>
            <p id="final-score">Skorunuz: 0</p>
            <button id="play-again-btn" class="action-btn start-btn" style="margin-top: 20px;">
                <i class="fas fa-play"></i> TEKRAR OYNA
            </button>
        </div>
    </div>

    <div id="pause-screen" class="pause-screen">
        <div class="game-over-content">
            <h2>OYUN DURAKLATILDI</h2>
            <p>Devam etmek i√ßin "Duraklat" butonuna basƒ±n</p>
            <button id="resume-btn" class="action-btn start-btn" style="margin-top: 20px;">
                <i class="fas fa-play"></i> DEVAM ET
            </button>
        </div>
    </div>

    <script>
        // Font Awesome i√ßin fallback
        if (!document.querySelector('.fa-gamepad')) {
            const style = document.createElement('style');
            style.innerHTML = `
                .fa-gamepad:before { content: "üéÆ "; }
                .fa-arrow-right:before { content: "‚Üí "; }
                .fa-info-circle:before { content: "‚ÑπÔ∏è "; }
                .fa-arrow-left:before { content: "‚Üê "; }
                .fa-redo:before { content: "‚Üª "; }
                .fa-arrow-down:before { content: "‚Üì "; }
                .fa-angle-double-down:before { content: "‚è¨ "; }
                .fa-play:before { content: "‚ñ∂ "; }
                .fa-pause:before { content: "‚è∏ "; }
                .fa-volume-up:before { content: "üîä "; }
                .fa-trophy:before { content: "üèÜ "; }
            `;
            document.head.appendChild(style);
        }

        // Tetris oyunu
        class TetrisGame {
            constructor() {
                this.canvas = document.getElementById('game-board');
                this.ctx = this.canvas.getContext('2d');
                this.nextCanvas = document.getElementById('next-piece');
                this.nextCtx = this.nextCanvas.getContext('2d');
                
                // Sesler i√ßin fallback - eƒüer harici sesler y√ºklenmezse alternatif sesler
                this.createAudioElements();
                
                this.BOARD_WIDTH = 10;
                this.BOARD_HEIGHT = 20;
                this.BLOCK_SIZE = 30;
                this.COLORS = [
                    null,
                    '#FF0D72', // I
                    '#0DC2FF', // J
                    '#0DFF72', // L
                    '#F538FF', // O
                    '#FF8E0D', // S
                    '#FFE138', // T
                    '#3877FF'  // Z
                ];
                
                // Tetromino ≈üekilleri
                this.PIECES = [
                    null,
                    [
                        [0,0,0,0],
                        [1,1,1,1],
                        [0,0,0,0],
                        [0,0,0,0]
                    ],
                    [
                        [2,0,0],
                        [2,2,2],
                        [0,0,0]
                    ],
                    [
                        [0,0,3],
                        [3,3,3],
                        [0,0,0]
                    ],
                    [
                        [4,4],
                        [4,4]
                    ],
                    [
                        [0,5,5],
                        [5,5,0],
                        [0,0,0]
                    ],
                    [
                        [0,6,0],
                        [6,6,6],
                        [0,0,0]
                    ],
                    [
                        [7,7,0],
                        [0,7,7],
                        [0,0,0]
                    ]
                ];
                
                this.board = this.createBoard();
                this.piece = this.createPiece();
                this.nextPiece = this.createPiece();
                this.score = 0;
                this.level = 1;
                this.lines = 0;
                this.gameOver = false;
                this.isPaused = false;
                this.dropCounter = 0;
                this.dropInterval = 1000; // Ba≈ülangƒ±√ß hƒ±zƒ±
                this.lastTime = 0;
                
                // Ses ayarlarƒ±
                this.soundEnabled = true;
                this.musicEnabled = true;
                this.volume = 0.7;
                
                // Y√ºksek skorlar
                this.highScores = this.loadHighScores();
                
                this.init();
            }
            
            createAudioElements() {
                // Fallback ses efektleri
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Eƒüer harici sesler y√ºklenemezse, alternatif sesler olu≈ütur
                this.audioElements = {
                    move: null,
                    rotate: null,
                    drop: null,
                    clear: null,
                    gameover: null,
                    music: null
                };
                
                // Web Audio API kullanarak basit sesler olu≈ütur
                this.createBeepSound = (frequency = 440, duration = 0.1) => {
                    if (!this.soundEnabled || this.volume === 0) return;
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(this.volume * 0.3, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                };
            }
            
            playSound(type) {
                if (!this.soundEnabled || this.volume === 0) return;
                
                switch(type) {
                    case 'move':
                        this.createBeepSound(200, 0.1);
                        break;
                    case 'rotate':
                        this.createBeepSound(300, 0.1);
                        break;
                    case 'drop':
                        this.createBeepSound(100, 0.2);
                        break;
                    case 'clear':
                        this.createBeepSound(800, 0.3);
                        setTimeout(() => this.createBeepSound(600, 0.3), 150);
                        setTimeout(() => this.createBeepSound(400, 0.3), 300);
                        break;
                    case 'gameover':
                        this.createBeepSound(150, 0.5);
                        setTimeout(() => this.createBeepSound(100, 0.5), 500);
                        break;
                }
            }
            
            createBoard() {
                return Array.from(
                    {length: this.BOARD_HEIGHT},
                    () => Array(this.BOARD_WIDTH).fill(0)
                );
            }
            
            createPiece() {
                const pieceId = Math.floor(Math.random() * 7) + 1;
                return {
                    pos: {x: Math.floor(this.BOARD_WIDTH / 2) - 1, y: 0},
                    matrix: this.PIECES[pieceId],
                    id: pieceId
                };
            }
            
            draw() {
                // Ana tahta
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.canvas.width = this.BLOCK_SIZE * this.BOARD_WIDTH;
                this.canvas.height = this.BLOCK_SIZE * this.BOARD_HEIGHT;
                
                // Board grid √ßiz
                for (let y = 0; y < this.BOARD_HEIGHT; y++) {
                    for (let x = 0; x < this.BOARD_WIDTH; x++) {
                        if (this.board[y][x]) {
                            this.ctx.fillStyle = this.COLORS[this.board[y][x]];
                            this.ctx.fillRect(
                                x * this.BLOCK_SIZE,
                                y * this.BLOCK_SIZE,
                                this.BLOCK_SIZE - 1,
                                this.BLOCK_SIZE - 1
                            );
                            
                            // 3D efekti
                            this.ctx.fillStyle = 'rgba(255,255,255,0.2)';
                            this.ctx.fillRect(
                                x * this.BLOCK_SIZE,
                                y * this.BLOCK_SIZE,
                                this.BLOCK_SIZE - 1,
                                2
                            );
                            this.ctx.fillRect(
                                x * this.BLOCK_SIZE,
                                y * this.BLOCK_SIZE,
                                2,
                                this.BLOCK_SIZE - 1
                            );
                        }
                    }
                }
                
                // Aktif par√ßayƒ± √ßiz
                this.drawPiece(this.piece, this.ctx);
                
                // Kƒ±lavuz √ßizgileri
                this.ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                this.ctx.lineWidth = 0.5;
                for (let x = 0; x <= this.BOARD_WIDTH; x++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x * this.BLOCK_SIZE, 0);
                    this.ctx.lineTo(x * this.BLOCK_SIZE, this.canvas.height);
                    this.ctx.stroke();
                }
                for (let y = 0; y <= this.BOARD_HEIGHT; y++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y * this.BLOCK_SIZE);
                    this.ctx.lineTo(this.canvas.width, y * this.BLOCK_SIZE);
                    this.ctx.stroke();
                }
                
                // Sonraki par√ßayƒ± √ßiz
                this.nextCtx.clearRect(0, 0, this.nextCanvas.width, this.nextCanvas.height);
                this.nextCtx.fillStyle = 'rgba(0,0,0,0.5)';
                this.nextCtx.fillRect(0, 0, this.nextCanvas.width, this.nextCanvas.height);
                this.drawPiece(this.nextPiece, this.nextCtx, 2.5, 2.5);
            }
            
            drawPiece(piece, context, offsetX = 0, offsetY = 0) {
                const matrix = piece.matrix;
                context.fillStyle = this.COLORS[piece.id];
                
                for (let y = 0; y < matrix.length; y++) {
                    for (let x = 0; x < matrix[y].length; x++) {
                        if (matrix[y][x]) {
                            context.fillRect(
                                (piece.pos.x + x + offsetX) * this.BLOCK_SIZE,
                                (piece.pos.y + y + offsetY) * this.BLOCK_SIZE,
                                this.BLOCK_SIZE - 1,
                                this.BLOCK_SIZE - 1
                            );
                            
                            // 3D efekti
                            context.fillStyle = 'rgba(255,255,255,0.2)';
                            context.fillRect(
                                (piece.pos.x + x + offsetX) * this.BLOCK_SIZE,
                                (piece.pos.y + y + offsetY) * this.BLOCK_SIZE,
                                this.BLOCK_SIZE - 1,
                                2
                            );
                            context.fillRect(
                                (piece.pos.x + x + offsetX) * this.BLOCK_SIZE,
                                (piece.pos.y + y + offsetY) * this.BLOCK_SIZE,
                                2,
                                this.BLOCK_SIZE - 1
                            );
                            
                            context.fillStyle = this.COLORS[piece.id];
                        }
                    }
                }
            }
            
            collide(board, piece) {
                const matrix = piece.matrix;
                for (let y = 0; y < matrix.length; y++) {
                    for (let x = 0; x < matrix[y].length; x++) {
                        if (matrix[y][x] &&
                            (board[piece.pos.y + y] === undefined ||
                             board[piece.pos.y + y][piece.pos.x + x] === undefined ||
                             board[piece.pos.y + y][piece.pos.x + x])) {
                            return true;
                        }
                    }
                }
                return false;
            }
            
            merge(board, piece) {
                const matrix = piece.matrix;
                for (let y = 0; y < matrix.length; y++) {
                    for (let x = 0; x < matrix[y].length; x++) {
                        if (matrix[y][x]) {
                            board[piece.pos.y + y][piece.pos.x + x] = piece.id;
                        }
                    }
                }
            }
            
            rotate(matrix) {
                const rotated = [];
                for (let i = 0; i < matrix[0].length; i++) {
                    rotated.push([]);
                    for (let j = matrix.length - 1; j >= 0; j--) {
                        rotated[i].push(matrix[j][i]);
                    }
                }
                return rotated;
            }
            
            pieceRotate() {
                const pos = this.piece.pos.x;
                let offset = 1;
                const rotated = this.rotate(this.piece.matrix);
                
                // Rotate sƒ±rasƒ±nda √ßarpƒ±≈ümayƒ± √∂nle
                while (this.collide(this.board, {
                    pos: this.piece.pos,
                    matrix: rotated,
                    id: this.piece.id
                })) {
                    this.piece.pos.x += offset;
                    offset = -(offset + (offset > 0 ? 1 : -1));
                    if (offset > this.piece.matrix[0].length) {
                        this.piece.pos.x = pos;
                        return;
                    }
                }
                
                this.piece.matrix = rotated;
                this.playSound('rotate');
            }
            
            pieceMove(dir) {
                this.piece.pos.x += dir;
                if (this.collide(this.board, this.piece)) {
                    this.piece.pos.x -= dir;
                    return false;
                }
                this.playSound('move');
                return true;
            }
            
            pieceDrop() {
                this.piece.pos.y++;
                if (this.collide(this.board, this.piece)) {
                    this.piece.pos.y--;
                    this.merge(this.board, this.piece);
                    this.resetPiece();
                    this.clearLines();
                    return false;
                }
                this.dropCounter = 0;
                return true;
            }
            
            pieceHardDrop() {
                while (this.pieceDrop()) {}
                this.playSound('drop');
            }
            
            resetPiece() {
                this.piece = this.nextPiece;
                this.nextPiece = this.createPiece();
                
                if (this.collide(this.board, this.piece)) {
                    this.gameOver = true;
                    this.playSound('gameover');
                    this.saveHighScore();
                    this.showGameOver();
                }
            }
            
            clearLines() {
                let linesCleared = 0;
                
                outer: for (let y = this.BOARD_HEIGHT - 1; y >= 0; y--) {
                    for (let x = 0; x < this.BOARD_WIDTH; x++) {
                        if (!this.board[y][x]) {
                            continue outer;
                        }
                    }
                    
                    // Satƒ±rƒ± temizle
                    const row = this.board.splice(y, 1)[0].fill(0);
                    this.board.unshift(row);
                    y++;
                    linesCleared++;
                }
                
                if (linesCleared > 0) {
                    // Skor hesapla
                    const linePoints = [40, 100, 300, 1200];
                    this.score += linePoints[linesCleared - 1] * this.level;
                    this.lines += linesCleared;
                    
                    // Seviye g√ºncelle
                    this.level = Math.floor(this.lines / 10) + 1;
                    this.dropInterval = Math.max(100, 1000 - (this.level - 1) * 100);
                    
                    this.updateUI();
                    this.playSound('clear');
                    
                    // Satƒ±r temizleme animasyonu
                    this.animateLineClear(linesCleared);
                }
            }
            
            animateLineClear(lines) {
                // Basit bir animasyon efekti
                const originalFill = this.ctx.fillStyle;
                this.ctx.fillStyle = 'rgba(255,255,255,0.7)';
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        this.draw();
                    }, i * 50);
                }
                
                setTimeout(() => {
                    this.ctx.fillStyle = originalFill;
                }, 250);
            }
            
            update(time = 0) {
                if (this.gameOver || this.isPaused) return;
                
                const deltaTime = time - this.lastTime;
                this.lastTime = time;
                
                this.dropCounter += deltaTime;
                if (this.dropCounter > this.dropInterval) {
                    this.pieceDrop();
                }
                
                this.draw();
                requestAnimationFrame(this.update.bind(this));
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
                document.getElementById('lines').textContent = this.lines;
                this.updateHighScoresList();
            }
            
            loadHighScores() {
                const scores = localStorage.getItem('tetrisHighScores');
                return scores ? JSON.parse(scores) : [
                    {name: '≈ûAMPƒ∞YON', score: 10000},
                    {name: 'ƒ∞Kƒ∞NCƒ∞', score: 7500},
                    {name: '√ú√á√úNC√ú', score: 5000},
                    {name: 'D√ñRD√úNC√ú', score: 3000},
                    {name: 'BE≈ûƒ∞NCƒ∞', score: 1500}
                ];
            }
            
            saveHighScore() {
                if (this.score > this.highScores[4].score) {
                    this.highScores.push({name: 'OYUNCU', score: this.score});
                    this.highScores.sort((a, b) => b.score - a.score);
                    this.highScores = this.highScores.slice(0, 5);
                    localStorage.setItem('tetrisHighScores', JSON.stringify(this.highScores));
                }
            }
            
            updateHighScoresList() {
                const list = document.getElementById('high-scores-list');
                list.innerHTML = '';
                this.highScores.forEach((score, index) => {
                    const div = document.createElement('div');
                    div.className = 'high-score-item';
                    div.innerHTML = `
                        <span>${index + 1}. ${score.name}</span>
                        <span>${score.score.toLocaleString()}</span>
                    `;
                    list.appendChild(div);
                });
            }
            
            showGameOver() {
                document.getElementById('final-score').textContent = `Skorunuz: ${this.score.toLocaleString()}`;
                document.getElementById('game-over').style.display = 'flex';
            }
            
            showPauseScreen() {
                document.getElementById('pause-screen').style.display = 'flex';
            }
            
            hidePauseScreen() {
                document.getElementById('pause-screen').style.display = 'none';
            }
            
            resetGame() {
                this.board = this.createBoard();
                this.piece = this.createPiece();
                this.nextPiece = this.createPiece();
                this.score = 0;
                this.level = 1;
                this.lines = 0;
                this.gameOver = false;
                this.isPaused = false;
                this.dropInterval = 1000;
                this.updateUI();
                this.draw();
                document.getElementById('game-over').style.display = 'none';
                this.hidePauseScreen();
            }
            
            init() {
                // Canvas boyutlarƒ±nƒ± ayarla
                this.canvas.width = this.BLOCK_SIZE * this.BOARD_WIDTH;
                this.canvas.height = this.BLOCK_SIZE * this.BOARD_HEIGHT;
                
                // UI'ƒ± g√ºncelle
                this.updateUI();
                
                // Kontrolleri baƒüla
                this.bindControls();
                
                // ƒ∞lk √ßizimi yap
                this.draw();
            }
            
            bindControls() {
                // Klavye kontrolleri
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver || this.isPaused) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            this.resetGame();
                            this.update();
                        }
                        return;
                    }
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                            this.pieceMove(-1);
                            break;
                        case 'ArrowRight':
                            this.pieceMove(1);
                            break;
                        case 'ArrowDown':
                            this.pieceDrop();
                            break;
                        case 'ArrowUp':
                            this.pieceRotate();
                            break;
                        case ' ':
                            this.pieceHardDrop();
                            break;
                        case 'p':
                        case 'P':
                            this.togglePause();
                            break;
                    }
                });
                
                // Buton kontrolleri
                document.getElementById('left-btn').addEventListener('click', () => {
                    this.pieceMove(-1);
                });
                
                document.getElementById('right-btn').addEventListener('click', () => {
                    this.pieceMove(1);
                });
                
                document.getElementById('down-btn').addEventListener('click', () => {
                    this.pieceDrop();
                });
                
                document.getElementById('rotate-btn').addEventListener('click', () => {
                    this.pieceRotate();
                });
                
                document.getElementById('drop-btn').addEventListener('click', () => {
                    this.pieceHardDrop();
                });
                
                // Oyun kontrolleri
                document.getElementById('start-btn').addEventListener('click', () => {
                    if (this.gameOver) {
                        this.resetGame();
                    }
                    this.isPaused = false;
                    this.hidePauseScreen();
                    this.update();
                });
                
                document.getElementById('pause-btn').addEventListener('click', () => {
                    this.togglePause();
                });
                
                document.getElementById('restart-btn').addEventListener('click', () => {
                    this.resetGame();
                    if (!this.isPaused) {
                        this.update();
                    }
                });
                
                // Oyun bitti ekranƒ±
                document.getElementById('play-again-btn').addEventListener('click', () => {
                    this.resetGame();
                    this.update();
                });
                
                // Duraklatma ekranƒ±
                document.getElementById('resume-btn').addEventListener('click', () => {
                    this.togglePause();
                });
                
                // Ses kontrolleri
                document.getElementById('game-sound').addEventListener('change', (e) => {
                    this.soundEnabled = e.target.checked;
                });
                
                document.getElementById('music').addEventListener('change', (e) => {
                    this.musicEnabled = e.target.checked;
                    if (!this.musicEnabled) {
                        this.stopMusic();
                    }
                });
                
                document.getElementById('volume').addEventListener('input', (e) => {
                    this.volume = e.target.value / 100;
                });
                
                // Touch events i√ßin
                let touchStartX = 0;
                let touchStartY = 0;
                
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                }, { passive: false });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (this.gameOver || this.isPaused) return;
                    
                    const touchEndX = e.changedTouches[0].clientX;
                    const touchEndY = e.changedTouches[0].clientY;
                    
                    const diffX = touchEndX - touchStartX;
                    const diffY = touchEndY - touchStartY;
                    
                    // Hareket i√ßin e≈üik deƒüeri
                    if (Math.abs(diffX) > Math.abs(diffY)) {
                        // Yatay hareket
                        if (diffX > 30) {
                            this.pieceMove(1); // Saƒü
                        } else if (diffX < -30) {
                            this.pieceMove(-1); // Sol
                        }
                    } else {
                        // Dikey hareket
                        if (diffY > 50) {
                            this.pieceHardDrop(); // A≈üaƒüƒ± kaydƒ±rma
                        } else if (diffY < -30) {
                            this.pieceRotate(); // Yukarƒ± (d√∂nd√ºr)
                        } else {
                            // Kƒ±sa dokunma - hƒ±zlandƒ±r
                            this.pieceDrop();
                        }
                    }
                }, { passive: false });
                
                // √áift tƒ±klama √∂nleme
                let lastTap = 0;
                this.canvas.addEventListener('touchend', (e) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    if (tapLength < 300 && tapLength > 0) {
                        // √áift tƒ±klama - anƒ±nda bƒ±rak
                        this.pieceHardDrop();
                        e.preventDefault();
                    }
                    lastTap = currentTime;
                });
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                if (this.isPaused) {
                    this.showPauseScreen();
                } else {
                    this.hidePauseScreen();
                    this.update();
                }
            }
            
            stopMusic() {
                // M√ºzik durdurma (eƒüer varsa)
                if (this.audioElements.music) {
                    this.audioElements.music.pause();
                }
            }
        }

        // Oyunu ba≈ülat
        window.addEventListener('load', () => {
            const game = new TetrisGame();
            
            // ƒ∞lk g√ºncellemeyi ba≈ülat
            requestAnimationFrame(game.update.bind(game));
            
            // Sayfa g√∂r√ºn√ºrl√ºƒü√º deƒüi≈ütiƒüinde duraklat
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    game.isPaused = true;
                    game.showPauseScreen();
                }
            });
            
            // Dokunmatik cihazlar i√ßin boyut ayarƒ±
            function resizeCanvas() {
                const canvas = document.getElementById('game-board');
                const container = canvas.parentElement;
                const containerWidth = container.clientWidth;
                
                if (containerWidth < 350) {
                    game.BLOCK_SIZE = 25;
                } else if (containerWidth < 450) {
                    game.BLOCK_SIZE = 28;
                } else {
                    game.BLOCK_SIZE = 30;
                }
                
                game.canvas.width = game.BLOCK_SIZE * game.BOARD_WIDTH;
                game.canvas.height = game.BLOCK_SIZE * game.BOARD_HEIGHT;
                game.draw();
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Cihaz y√∂n deƒüi≈üikliƒüi
            window.addEventListener('orientationchange', () => {
                setTimeout(resizeCanvas, 100);
            });
        });
    </script>
</body>
</html>
