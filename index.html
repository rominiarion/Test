<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Zen: Ultimate Edition</title>
    <style>
        :root {
            --bg-color: #0b0c10;
            --grid-bg: #1f2833;
            --cell-empty: #2c3540;
            --accent: #66fcf1;
            --accent-dim: #45a29e;
            --text-primary: #ffffff;
            --text-secondary: #c5c6c7;
            --gold: #ffd700;
            --danger: #ff4b4b;
            --c1: #f39c12; --c2: #e74c3c; --c3: #8e44ad; --c4: #3498db; --c5: #2ecc71; 
        }

        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-user-select: none; font-family: 'Segoe UI', sans-serif; }

        body {
            margin: 0; background-color: var(--bg-color); color: var(--text-primary);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; overflow: hidden;
        }

        /* SCREEN SYSTEM */
        .screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-color); z-index: 1000;
        }
        .hidden { display: none !important; }

        .menu-title { font-size: 2.5rem; color: var(--accent); text-align: center; margin-bottom: 40px; text-shadow: 0 0 15px var(--accent-dim); line-height: 1; }
        .menu-btn {
            width: 220px; padding: 15px; margin: 10px; background: transparent;
            border: 2px solid var(--accent); color: var(--accent); font-size: 1.1rem;
            font-weight: bold; cursor: pointer; border-radius: 8px; transition: 0.3s;
        }
        .menu-btn:hover { background: var(--accent); color: var(--bg-color); }

        /* SETTINGS */
        .settings-card { background: var(--grid-bg); padding: 30px; border-radius: 15px; width: 320px; border: 1px solid var(--accent-dim); }
        .row { margin-bottom: 25px; }
        .row label { display: block; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-secondary); }
        input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }

        /* HEADER */
        .header {
            width: 100%; max-width: 450px; display: flex; justify-content: space-between;
            padding: 15px 20px; background: rgba(31, 40, 51, 0.9); position: fixed;
            top: 0; z-index: 100; border-bottom: 1px solid rgba(102, 252, 241, 0.1);
        }

        /* GAME AREA */
        .game-area { margin-top: 70px; display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        .grid {
            width: 90vw; max-width: 380px; aspect-ratio: 1; background: var(--grid-bg);
            border-radius: 8px; padding: 6px; display: grid;
            grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(8, 1fr);
            gap: 4px; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .cell { background-color: var(--cell-empty); border-radius: 4px; transition: background 0.15s; }
        .cell.filled { box-shadow: inset 0 0 5px rgba(0,0,0,0.3); }
        .cell.ghost { background-color: rgba(255,255,255,0.3) !important; border: 2px solid #fff; z-index: 2; }

        /* POWERUPS */
        .powerup-bar { width: 92vw; max-width: 380px; display: flex; justify-content: space-between; margin: 15px 0; }
        .power-btn {
            background: var(--grid-bg); border: 1px solid var(--accent-dim); color: var(--accent);
            border-radius: 8px; width: 31%; height: 50px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; font-weight: bold; cursor: pointer;
        }
        .power-btn:disabled { opacity: 0.2; }
        .power-btn.active-mode { background: var(--accent); color: var(--bg-color); box-shadow: 0 0 15px var(--accent); }
        .power-btn span:last-child { color: var(--gold); font-size: 0.6rem; }

        /* DOCK */
        .dock { width: 100%; max-width: 450px; height: 130px; display: flex; justify-content: space-around; align-items: center; }
        .slot { width: 32%; height: 100%; display: flex; justify-content: center; align-items: center; background: rgba(255,255,255,0.03); border-radius: 10px; cursor: pointer; }

        .shape-preview { display: grid; gap: 2px; pointer-events: none; }
        .block { width: 22px; height: 22px; border-radius: 3px; }
        .shape-preview.dragging { position: fixed; z-index: 9999; pointer-events: none; gap: 4px; }
        .shape-preview.dragging .block { width: var(--drag-size); height: var(--drag-size); box-shadow: 0 5px 15px rgba(0,0,0,0.4); }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="screenMenu" class="screen">
        <h1 class="menu-title">NEON ZEN<br><span style="font-size: 1rem; letter-spacing: 4px; color: var(--text-secondary);">GITHUB AUDIO ED.</span></h1>
        <button class="menu-btn" onclick="game.uiStartGame()">OYNA</button>
        <button class="menu-btn" onclick="game.uiShowSettings()">AYARLAR</button>
    </div>

    <div id="screenSettings" class="screen hidden">
        <div class="settings-card">
            <h2 style="color:var(--accent); margin-top:0">AYARLAR</h2>
            <div class="row">
                <label>Müzik Sesi</label>
                <input type="range" id="volMusic" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="row">
                <label>Efekt Sesi</label>
                <input type="range" id="volSfx" min="0" max="1" step="0.1" value="0.5">
            </div>
            <button class="menu-btn" onclick="game.uiShowMenu()" style="width:100%; margin:0">GERİ</button>
        </div>
    </div>

    <div class="header">
        <div style="display:flex; flex-direction:column">
            <span style="font-size:0.6rem; color:var(--text-secondary)">PUAN</span>
            <span id="scoreTxt" style="font-size:1.2rem; font-weight:bold">0</span>
        </div>
        <button onclick="game.uiShowMenu()" style="background:none; border:1px solid var(--accent); color:var(--accent); padding:4px 12px; border-radius:4px; font-size:0.8rem">MENÜ</button>
        <div style="display:flex; flex-direction:column; align-items:flex-end">
            <span style="font-size:0.6rem; color:var(--text-secondary)">ALTIN</span>
            <span id="goldTxt" style="font-size:1.2rem; font-weight:bold; color:var(--gold)">0</span>
        </div>
    </div>

    <div class="game-area">
        <div class="grid" id="grid"></div>
        
        <div class="powerup-bar">
            <button class="power-btn" id="pwr1" onclick="game.togglePower('single')"><span>TEK SİL</span><span>150</span></button>
            <button class="power-btn" id="pwr2" onclick="game.togglePower('cross')"><span>SÜTUN SİL</span><span>500</span></button>
            <button class="power-btn" id="pwr3" onclick="game.togglePower('nuke')"><span>FULL SİL</span><span>1000</span></button>
        </div>

        <div class="dock">
            <div class="slot" id="slot0" onmousedown="game.handleGrab(event, 0)" ontouchstart="game.handleGrab(event, 0)"></div>
            <div class="slot" id="slot1" onmousedown="game.handleGrab(event, 1)" ontouchstart="game.handleGrab(event, 1)"></div>
            <div class="slot" id="slot2" onmousedown="game.handleGrab(event, 2)" ontouchstart="game.handleGrab(event, 2)"></div>
        </div>
    </div>

    <div id="overlay" class="overlay">
        <h2 style="color:var(--danger); font-size: 3rem; margin:0">OYUN BİTTİ</h2>
        <button class="menu-btn" onclick="game.resetGame()">TEKRAR DENE</button>
    </div>

    <script>
        const Sound = {
            music: new Audio(),
            volM: 0.5,
            volS: 0.5,
            tracks: {
                menu: "https://raw.githubusercontent.com/KULLANICI_ADIN/DEPO_ADIN/main/1.mp3", // BURAYI GÜNCELLE
                game: "https://raw.githubusercontent.com/KULLANICI_ADIN/DEPO_ADIN/main/2.mp3"  // BURAYI GÜNCELLE
            },
            init() {
                this.music.loop = true;
                document.getElementById('volMusic').oninput = (e) => { this.volM = e.target.value; this.music.volume = this.volM; };
                document.getElementById('volSfx').oninput = (e) => { this.volS = e.target.value; };
            },
            play(key) {
                if(this.music.src !== this.tracks[key]) {
                    this.music.src = this.tracks[key];
                    this.music.volume = this.volM;
                    this.music.play().catch(() => {});
                }
            },
            sfx(f1, f2, type='sine') {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const o = ctx.createOscillator(), g = ctx.createGain();
                    o.type = type; o.frequency.setValueAtTime(f1, ctx.currentTime);
                    if(f2) o.frequency.exponentialRampToValueAtTime(f2, ctx.currentTime + 0.1);
                    g.gain.setValueAtTime(this.volS * 0.1, ctx.currentTime);
                    g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    o.connect(g); g.connect(ctx.destination);
                    o.start(); o.stop(ctx.currentTime + 0.1);
                } catch(e){}
            }
        };

        const GRID_SIZE = 8;
        const SHAPES = [[[1]], [[1,1]], [[1,1,1]], [[1,1,1,1]], [[1,1],[1,1]], [[1,1,1],[0,1,0]], [[1,0],[1,0],[1,1]], [[1,1,0],[0,1,1]]];
        const COLORS = ['#f39c12', '#e74c3c', '#8e44ad', '#3498db', '#2ecc71'];

        class Game {
            constructor() {
                this.grid = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(null));
                this.score = 0; this.gold = 0;
                this.currentShapes = [null, null, null];
                this.dragged = null;
                this.activePower = null;
                this.gridEl = document.getElementById('grid');
                this.init();
            }

            init() {
                this.renderGrid();
                Sound.init();
                setTimeout(() => {
                    this.cellSize = this.gridEl.children[0].offsetWidth;
                    document.documentElement.style.setProperty('--drag-size', this.cellSize + 'px');
                }, 100);
            }

            renderGrid() {
                this.gridEl.innerHTML = '';
                for(let i=0; i<64; i++) {
                    const c = document.createElement('div');
                    c.className = 'cell';
                    c.onclick = () => this.usePower(Math.floor(i/8), i%8);
                    this.gridEl.appendChild(c);
                }
            }

            uiStartGame() {
                document.getElementById('screenMenu').classList.add('hidden');
                document.getElementById('screenSettings').classList.add('hidden');
                Sound.play('game');
                this.spawnShapes();
            }

            uiShowSettings() {
                document.getElementById('screenMenu').classList.add('hidden');
                document.getElementById('screenSettings').classList.remove('hidden');
            }

            uiShowMenu() {
                document.getElementById('screenSettings').classList.add('hidden');
                document.getElementById('screenMenu').classList.remove('hidden');
                Sound.play('menu');
            }

            spawnShapes() {
                for(let i=0; i<3; i++) if(!this.currentShapes[i]) {
                    const m = SHAPES[Math.floor(Math.random()*SHAPES.length)];
                    const c = COLORS[Math.floor(Math.random()*COLORS.length)];
                    this.currentShapes[i] = { matrix: m, color: c };
                    this.drawSlot(i, m, c);
                }
                if(this.checkGameOver()) document.getElementById('overlay').style.display='flex';
            }

            drawSlot(idx, m, color) {
                const s = document.getElementById('slot'+idx);
                s.innerHTML = '';
                const w = document.createElement('div');
                w.className = 'shape-preview';
                w.id = 'p-'+idx;
                w.style.gridTemplateColumns = `repeat(${m[0].length}, 1fr)`;
                m.forEach(row => row.forEach(v => {
                    const b = document.createElement('div');
                    if(v) { b.className = 'block'; b.style.backgroundColor = color; }
                    else { b.style.width = '22px'; }
                    w.appendChild(b);
                }));
                s.appendChild(w);
            }

            handleGrab(e, idx) {
                if(!this.currentShapes[idx] || this.activePower) return;
                e.preventDefault();
                Sound.sfx(600, 800);
                const el = document.getElementById('p-'+idx);
                const m = this.currentShapes[idx].matrix;
                this.dragged = { el, idx, data: this.currentShapes[idx], parent: el.parentNode, pR: Math.floor(m.length/2), pC: Math.floor(m[0].length/2) };
                el.classList.add('dragging');
                document.body.appendChild(el);
                this.onMove(e);
            }

            onMove(e) {
                if(!this.dragged) return;
                const t = e.touches ? e.touches[0] : e;
                const bS = this.cellSize + 4;
                this.dragged.el.style.left = (t.clientX - (this.dragged.pC * bS) - (this.cellSize/2)) + 'px';
                this.dragged.el.style.top = (t.clientY - (this.dragged.pR * bS) - (this.cellSize/2) - 120) + 'px';
                this.clearGhost();
                const pos = this.getGridPos(t.clientX, t.clientY - 120);
                if(pos) {
                    const sR = pos.r - this.dragged.pR, sC = pos.c - this.dragged.pC;
                    if(this.canPlace(this.dragged.data.matrix, sR, sC)) this.drawGhost(this.dragged.data.matrix, sR, sC);
                }
            }

            endDrag(e) {
                if(!this.dragged) return;
                const t = e.changedTouches ? e.changedTouches[0] : e;
                const pos = this.getGridPos(t.clientX, t.clientY - 120);
                let placed = false;
                if(pos) {
                    const sR = pos.r - this.dragged.pR, sC = pos.c - this.dragged.pC;
                    if(this.canPlace(this.dragged.data.matrix, sR, sC)) {
                        this.dragged.data.matrix.forEach((row, i) => row.forEach((v, j) => { if(v) this.grid[sR+i][sC+j] = this.dragged.data.color; }));
                        this.currentShapes[this.dragged.idx] = null;
                        this.dragged.el.remove();
                        Sound.sfx(400, 200);
                        this.checkLines();
                        if(this.currentShapes.every(x=>x===null)) this.spawnShapes();
                        placed = true;
                    }
                }
                if(!placed) { this.dragged.el.classList.remove('dragging'); this.dragged.parent.appendChild(this.dragged.el); }
                this.clearGhost(); this.refreshGrid(); this.dragged = null;
            }

            getGridPos(x, y) {
                const rct = this.gridEl.getBoundingClientRect();
                const c = Math.floor((x - rct.left) / (rct.width / 8)), r = Math.floor((y - rct.top) / (rct.height / 8));
                return (r >= 0 && r < 8 && c >= 0 && c < 8) ? {r,c} : null;
            }

            canPlace(m, r, c) {
                return m.every((row, i) => row.every((v, j) => {
                    if(!v) return true;
                    const nR = r+i, nC = c+j;
                    return nR>=0 && nR<8 && nC>=0 && nC<8 && !this.grid[nR][nC];
                }));
            }

            drawGhost(m, r, c) { m.forEach((row, i) => row.forEach((v, j) => { if(v) this.gridEl.children[(r+i)*8+(c+j)].classList.add('ghost'); })); }
            clearGhost() { document.querySelectorAll('.ghost').forEach(x=>x.classList.remove('ghost')); }

            refreshGrid() {
                for(let i=0; i<64; i++) this.gridEl.children[i].style.backgroundColor = this.grid[Math.floor(i/8)][i%8] || 'var(--cell-empty)';
            }

            checkLines() {
                let rL = [], cL = [];
                for(let r=0; r<8; r++) if(this.grid[r].every(x=>x)) rL.push(r);
                for(let c=0; c<8; c++) { let f=true; for(let r=0; r<8; r++) if(!this.grid[r][c]) f=false; if(f) cL.push(c); }
                if(rL.length + cL.length > 0) {
                    this.score += (rL.length + cL.length) * 100; this.gold += (rL.length + cL.length) * 10;
                    rL.forEach(r => this.grid[r].fill(null)); cL.forEach(c => { for(let r=0; r<8; r++) this.grid[r][c]=null; });
                    Sound.sfx(800, 1200, 'square'); this.updateUI();
                }
            }

            togglePower(t) {
                this.activePower = (this.activePower === t) ? null : t;
                if(t === 'nuke' && this.gold >= 1000) { if(confirm('Tüm alanı temizle?')) { this.grid = this.grid.map(r=>r.fill(null)); this.gold -= 1000; this.activePower=null; this.refreshGrid(); this.updateUI(); }}
                else if(this.gold < (t === 'single' ? 150 : 500)) this.activePower = null;
                document.querySelectorAll('.power-btn').forEach(b => b.classList.toggle('active-mode', b.id === (t==='single'?'pwr1':t==='cross'?'pwr2':'pwr3') && this.activePower));
            }

            usePower(r, c) {
                if(!this.activePower) return;
                if(this.activePower === 'single' && this.gold >= 150) { this.grid[r][c] = null; this.gold -= 150; }
                else if(this.activePower === 'cross' && this.gold >= 500) { for(let i=0; i<8; i++) { this.grid[r][i] = null; this.grid[i][c] = null; } this.gold -= 500; }
                this.activePower = null; this.refreshGrid(); this.updateUI();
                document.querySelectorAll('.power-btn').forEach(b => b.classList.remove('active-mode'));
            }

            updateUI() { document.getElementById('scoreTxt').innerText = this.score; document.getElementById('goldTxt').innerText = this.gold; }
            checkGameOver() { return this.currentShapes.filter(s=>s).every(s => { for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(this.canPlace(s.matrix, r, c)) return false; return true; }); }
            resetGame() { this.grid = this.grid.map(r=>r.fill(null)); this.score = 0; this.gold = 0; this.currentShapes = [null,null,null]; document.getElementById('overlay').style.display='none'; this.refreshGrid(); this.updateUI(); this.spawnShapes(); }
        }

        const game = new Game();
        window.addEventListener('mousemove', e => game.onMove(e));
        window.addEventListener('touchmove', e => game.onMove(e), {passive:false});
        window.addEventListener('mouseup', e => game.endDrag(e));
        window.addEventListener('touchend', e => game.endDrag(e));
    </script>
</body>
</html>
